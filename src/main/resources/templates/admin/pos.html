<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout-admin}">
<head>
  <title>Bán hàng tại quầy (POS)</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/admin.css">
  <link rel="stylesheet" href="/css/pos.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" />
</head>

<body>
<div layout:fragment="content">
  <div class="pos-title" th:text="#{pos.title}">Bán hàng tại quầy (POS)</div>

  <!-- Tìm sản phẩm -->
  <div class="pos-section">
    <label for="search" th:text="#{pos.search.label}">Tìm sản phẩm:</label>
    <div style="position:relative;display:inline-block;width:100%;max-width:480px;">
      <input type="text" id="search" th:placeholder="#{pos.search.placeholder}"
             oninput="liveSearchProducts()" autocomplete="off" style="width:100%;">
      <div id="search-dropdown" class="search-dropdown" style="display:none;"></div>
    </div>
    <button class="pos-btn" onclick="searchProducts()" th:text="#{pos.search.button}">Tìm kiếm</button>
    <div id="search-results"></div>
  </div>

  <!-- Giỏ hàng -->
  <div class="pos-section">
    <h3 th:text="#{cart.name}">Giỏ hàng</h3>
    <table class="pos-table" id="cart-table">
      <thead>
      <tr>
        <th th:text="#{product.name}">Tên sản phẩm</th>
        <th th:text="#{product.salePrice}">Giá</th>
        <th th:text="#{product.quantity}">Số lượng</th>
        <th th:text="#{checkout.total}">Thành tiền</th>
        <th th:text="#{cart.clear}">Xóa</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="pos-total" th:text="#{cart.total.payment}">Tổng tiền: <span id="cart-total">0</span> VNĐ</div>
  </div>

  <!-- Thông tin khách hàng & thanh toán -->
  <div class="pos-section">
    <h3 th:text="#{pos.customer.payment}">Thông tin khách hàng & thanh toán</h3>
    <form id="pos-form" onsubmit="submitOrder(event)">
      <div>
        <label th:text="#{pos.customer.name}">Họ tên khách hàng:</label>
        <input type="text" name="hoTen" th:placeholder="#{pos.customer.name.placeholder}" required>
      </div>
      <div>
        <label th:text="#{pos.customer.phone}">Số điện thoại:</label>
        <input type="text" name="sdt">
      </div>
      <div>
        <label th:text="#{pos.customer.note}">Ghi chú:</label>
        <input type="text" name="ghiChu" th:placeholder="#{pos.customer.note.placeholder}">
      </div>
      <div>
        <label th:text="#{pos.payment.method}">Phương thức thanh toán:</label>
        <select name="phuongThucThanhToan" id="payment-method" onchange="updatePaymentFields()">
          <option value="1" th:text="#{pos.payment.cash}">Tiền mặt</option>
          <option value="2" th:text="#{pos.payment.bank}">Chuyển khoản</option>
        </select>
      </div>

      <div id="cash-field" style="display:none;">
        <label th:text="#{pos.payment.cash}">Tiền mặt:</label>
        <input type="number" name="tienMat" min="0" value="0">
      </div>

      <div id="bank-field" style="display:none;">
        <label th:text="#{pos.payment.bankAmount}">Tiền chuyển khoản:</label>
        <input type="number" name="tienChuyenKhoan" min="0" value="0">
        <div style="margin-top:8px;">
          <label th:text="#{pos.payment.qr}">Mã QR chuyển khoản:</label><br>
          <img src="/images/qr-code.jpg" alt="QR chuyển khoản"
               style="max-width:160px;border-radius:8px;box-shadow:0 2px 8px #ccc;">
        </div>
      </div>

      <button class="pos-btn" type="submit">
        <i class="fa-solid fa-cart-plus"></i><span th:text="#{pos.createOrder}">Tạo đơn hàng</span>
      </button>
    </form>
    <div id="order-result"></div>
  </div>

  <script src="/js/pos.js"></script>
  <script>
    function updatePaymentFields() {
      var method = document.getElementById('payment-method').value;
      document.getElementById('cash-field').style.display = (method === '1') ? 'block' : 'none';
      document.getElementById('bank-field').style.display = (method === '2') ? 'block' : 'none';
    }
    window.onload = updatePaymentFields;
  </script>
  <script th:inline="javascript">
    /*<![CDATA[*/
    window.i18n = {
      add: /*[[#{pos.add}]]*/ 'Thêm',
      outOfStock: /*[[#{pos.outOfStock}]]*/ 'Hết hàng',
      notFound: /*[[#{pos.notFound}]]*/ 'Không tìm thấy sản phẩm',
      emptyCart: /*[[#{pos.emptyCart}]]*/ 'Vui lòng chọn sản phẩm!',
      orderSuccess: /*[[#{pos.orderSuccess}]]*/ 'Đã tạo đơn thành công!',
      orderError: /*[[#{pos.orderError}]]*/ 'Lỗi tạo đơn!',
      clear: /*[[#{pos.clear}]]*/ 'Xóa',
    };
    /*]]>*/
  </script>
</div>
</body>
</html>
