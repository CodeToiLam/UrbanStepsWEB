<!DOCTYPE html>
<html lang="en">
<head>
    <title th:text="#{spct.detail.title}">Chi Tiết Sản Phẩm</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script th:src="@{/js/checkout-fix.js}"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2 th:text="${sanPham.tenSanPham}">Tên sản phẩm</h2>
    <div class="row">
       <div class="col-md-6">
          <img th:if="${sanPham != null && sanPham.idHinhAnhDaiDien != null}"
              th:src="${sanPham.idHinhAnhDaiDien.fullImagePath}"
              alt="Hình ảnh sản phẩm" class="img-fluid"
              onerror="this.onerror=null; this.src='/images/no-image.jpg';">
          <img th:unless="${sanPham != null && sanPham.idHinhAnhDaiDien != null}"
              src="/images/no-image.jpg" alt="No image" class="img-fluid">
       </div>
        <div class="col-md-6">
            <p><strong>Giá bán:</strong> <span th:text="${#numbers.formatDecimal(sanPham.giaBan, 0, 0)} + ' VNĐ'">0 VNĐ</span></p>
            <p><strong>Mô tả:</strong> <span th:text="${sanPham.moTa}">Mô tả sản phẩm</span></p>
            <p><strong>Thương hiệu:</strong> <span th:text="${sanPham.idThuongHieu != null ? sanPham.idThuongHieu.tenThuongHieu : 'N/A'}">Thương hiệu</span></p>
            <div id="add-to-cart-message"></div>
            <button id="addToCartBtn" class="btn btn-primary mt-3" type="button">Thêm vào giỏ hàng</button>
            <a th:href="@{/san-pham}" class="btn btn-secondary ms-2">Quay lại danh sách</a>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('addToCartBtn').addEventListener('click', function() {
        // Lấy id sản phẩm chi tiết (giả sử có biến sanPhamChiTietId trong model)
        var sanPhamChiTietId = /*[[${sanPham.id}]]*/ 0;
        fetch('/api/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: 'sanPhamChiTietId=' + sanPhamChiTietId + '&soLuong=1'
        })
        .then(res => res.json().then(data => ({status: res.status, body: data})))
        .then(result => {
            var msgDiv = document.getElementById('add-to-cart-message');
            if (result.status === 401 && result.body.requireLogin) {
                msgDiv.innerHTML = '<div class="alert alert-warning mt-2">Vui lòng <a href="/tai-khoan/dang-nhap">đăng nhập</a> để thêm sản phẩm vào giỏ hàng.</div>';
            } else if (result.body.success) {
                msgDiv.innerHTML = '<div class="alert alert-success mt-2">' + result.body.message + '</div>';
            } else {
                msgDiv.innerHTML = '<div class="alert alert-danger mt-2">' + (result.body.message || 'Có lỗi xảy ra!') + '</div>';
            }
        })
        .catch(() => {
            document.getElementById('add-to-cart-message').innerHTML = '<div class="alert alert-danger mt-2">Có lỗi xảy ra!</div>';
        });
    });
</script>
</body>
</html>

